# Generated by Django 4.2.27 on 2026-01-20 11:56

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import uuid


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('security', '0002_quantumentropybatch_quantumpoolstatus_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='EntangledDevicePair',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('pending', 'Pending Pairing'), ('active', 'Active'), ('suspended', 'Suspended'), ('revoked', 'Revoked')], default='pending', max_length=20)),
                ('pairing_initiated_at', models.DateTimeField(auto_now_add=True)),
                ('pairing_completed_at', models.DateTimeField(blank=True, null=True)),
                ('last_sync_at', models.DateTimeField(blank=True, null=True)),
                ('revoked_at', models.DateTimeField(blank=True, null=True)),
                ('revocation_reason', models.TextField(blank=True)),
                ('device_a', models.ForeignKey(help_text='First device in the entangled pair', on_delete=django.db.models.deletion.CASCADE, related_name='entangled_as_device_a', to='security.userdevice')),
                ('device_b', models.ForeignKey(help_text='Second device in the entangled pair', on_delete=django.db.models.deletion.CASCADE, related_name='entangled_as_device_b', to='security.userdevice')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='entangled_pairs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Entangled Device Pair',
                'verbose_name_plural': 'Entangled Device Pairs',
                'db_table': 'entangled_device_pair',
                'ordering': ['-pairing_initiated_at'],
            },
        ),
        migrations.CreateModel(
            name='SharedRandomnessPool',
            fields=[
                ('pair', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, primary_key=True, serialize=False, to='security.entangleddevicepair')),
                ('encrypted_pool_a', models.BinaryField(help_text="Pool encrypted with device A's derived key")),
                ('encrypted_pool_b', models.BinaryField(help_text="Pool encrypted with device B's derived key")),
                ('pool_generation', models.IntegerField(default=0, help_text='Generation number, incremented on each rotation')),
                ('entropy_measurement', models.FloatField(default=8.0, help_text='Shannon entropy in bits per byte (8.0 = perfect random)')),
                ('last_refreshed_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Shared Randomness Pool',
                'verbose_name_plural': 'Shared Randomness Pools',
                'db_table': 'shared_randomness_pool',
            },
        ),
        migrations.CreateModel(
            name='UserTypingProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('preferred_substitutions', models.JSONField(default=dict, help_text="Learned substitutions: {'o': '0', 'a': '@', 'e': '3'}")),
                ('substitution_confidence', models.JSONField(default=dict, help_text="Confidence per substitution: {'o->0': 0.85}")),
                ('average_wpm', models.FloatField(blank=True, help_text='Average words per minute', null=True)),
                ('wpm_variance', models.FloatField(blank=True, help_text='Variance in typing speed', null=True)),
                ('error_prone_positions', models.JSONField(default=dict, help_text='Positions with high error rate: {3: 0.25, 7: 0.15}')),
                ('common_error_types', models.JSONField(default=dict, help_text="Common error types: {'adjacent_key': 0.4, 'case_swap': 0.3}")),
                ('rhythm_signature', models.JSONField(default=list, help_text='Normalized timing pattern signature')),
                ('total_sessions', models.IntegerField(default=0)),
                ('successful_sessions', models.IntegerField(default=0)),
                ('success_rate', models.FloatField(default=0.0)),
                ('profile_confidence', models.FloatField(default=0.0, help_text='Confidence in profile (0-1, based on data quantity)')),
                ('minimum_sessions_for_suggestion', models.IntegerField(default=10, help_text='Min sessions before suggesting adaptations')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_session_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='typing_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'User Typing Profile',
                'db_table': 'user_typing_profile',
            },
        ),
        migrations.CreateModel(
            name='TimeLockCapsule',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('encrypted_data', models.BinaryField(help_text='AES-encrypted password data')),
                ('encryption_key_encrypted', models.BinaryField(help_text='Encryption key, encrypted with master key')),
                ('mode', models.CharField(choices=[('server', 'Server Enforced'), ('client', 'Client Solvable'), ('hybrid', 'Hybrid (Both)')], default='server', max_length=20)),
                ('delay_seconds', models.IntegerField(help_text='Original delay in seconds')),
                ('status', models.CharField(choices=[('locked', 'Locked'), ('solving', 'Solving'), ('unlocked', 'Unlocked'), ('cancelled', 'Cancelled'), ('expired', 'Expired')], default='locked', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('unlock_at', models.DateTimeField()),
                ('unlocked_at', models.DateTimeField(blank=True, null=True)),
                ('beneficiary_email', models.EmailField(blank=True, help_text='Email to notify when capsule unlocks', max_length=254, null=True)),
                ('requires_verification', models.BooleanField(default=True, help_text='Require identity verification to unlock')),
                ('puzzle_data', models.JSONField(blank=True, help_text='RSA puzzle parameters for client-side solving', null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='time_lock_capsules', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Time-Lock Capsule',
                'verbose_name_plural': 'Time-Lock Capsules',
                'db_table': 'time_lock_capsule',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PasswordAdaptation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('password_hash_prefix', models.CharField(help_text='Hash prefix of ORIGINAL password', max_length=16)),
                ('adapted_hash_prefix', models.CharField(help_text='Hash prefix of ADAPTED password', max_length=16)),
                ('adaptation_generation', models.IntegerField(default=1, help_text='Generation number in adaptation chain')),
                ('adaptation_type', models.CharField(choices=[('substitution', 'Character Substitution'), ('reorder', 'Character Reordering'), ('simplify', 'Simplification'), ('hybrid', 'Hybrid (Multiple)')], max_length=20)),
                ('substitutions_applied', models.JSONField(default=dict, help_text="Map of substitutions: {position: {from: 'a', to: '@'}}")),
                ('confidence_score', models.FloatField(help_text='ML model confidence (0.0-1.0)')),
                ('memorability_score_before', models.FloatField(blank=True, null=True)),
                ('memorability_score_after', models.FloatField(blank=True, null=True)),
                ('status', models.CharField(choices=[('suggested', 'Suggested'), ('accepted', 'Accepted'), ('rejected', 'Rejected'), ('active', 'Active'), ('rolled_back', 'Rolled Back')], default='suggested', max_length=20)),
                ('suggested_at', models.DateTimeField(auto_now_add=True)),
                ('decided_at', models.DateTimeField(blank=True, help_text='When user accepted/rejected', null=True)),
                ('rolled_back_at', models.DateTimeField(blank=True, null=True)),
                ('reason', models.TextField(blank=True, help_text='Human-readable reason for this adaptation')),
                ('previous_adaptation', models.ForeignKey(blank=True, help_text='Previous adaptation (for rollback chain)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_adaptations', to='security.passwordadaptation')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='password_adaptations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Password Adaptation',
                'verbose_name_plural': 'Password Adaptations',
                'db_table': 'password_adaptation',
                'ordering': ['-suggested_at'],
            },
        ),
        migrations.CreateModel(
            name='EntanglementSyncEvent',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('event_type', models.CharField(choices=[('key_rotation', 'Key Rotation'), ('entropy_check', 'Entropy Check'), ('anomaly_detected', 'Anomaly Detected'), ('instant_revoke', 'Instant Revocation'), ('pool_refresh', 'Pool Refresh'), ('sync_request', 'Sync Request')], max_length=30)),
                ('success', models.BooleanField(default=True)),
                ('details', models.JSONField(blank=True, default=dict, help_text='Additional event details')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('initiated_by_device', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='initiated_sync_events', to='security.userdevice')),
                ('pair', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sync_events', to='security.entangleddevicepair')),
            ],
            options={
                'verbose_name': 'Entanglement Sync Event',
                'verbose_name_plural': 'Entanglement Sync Events',
                'db_table': 'entanglement_sync_event',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DNAEncodedPassword',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('service_name', models.CharField(blank=True, default='', help_text='Name of the service/account this password is for', max_length=255)),
                ('notes', models.TextField(blank=True, default='', help_text='Optional notes about this stored password')),
                ('sequence_hash', models.CharField(help_text='SHA-256 of DNA sequence', max_length=64)),
                ('password_hash_prefix', models.CharField(help_text='First 16 chars of password hash for verification', max_length=16)),
                ('sequence_length_bp', models.IntegerField(help_text='DNA sequence length in base pairs')),
                ('gc_content', models.FloatField(help_text='GC content percentage (0.0-1.0)')),
                ('has_error_correction', models.BooleanField(default=True)),
                ('encoding_version', models.CharField(default='v1', max_length=20)),
                ('status', models.CharField(choices=[('encoded', 'Encoded (Digital Only)'), ('synthesis_pending', 'Synthesis Pending'), ('synthesis_complete', 'Synthesis Complete'), ('in_storage', 'In Physical Storage'), ('retrieval_pending', 'Retrieval Pending'), ('retrieved', 'Retrieved'), ('expired', 'Expired')], default='encoded', max_length=30)),
                ('synthesis_order_id', models.CharField(blank=True, max_length=100, null=True)),
                ('synthesis_provider', models.CharField(blank=True, max_length=50, null=True)),
                ('synthesis_cost_usd', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('physical_sample_id', models.CharField(blank=True, help_text='ID of physical DNA sample in storage', max_length=100, null=True)),
                ('storage_location', models.CharField(blank=True, max_length=255, null=True)),
                ('storage_temperature_kelvin', models.FloatField(blank=True, null=True)),
                ('time_lock_enabled', models.BooleanField(default=False)),
                ('time_lock_capsule_id', models.CharField(blank=True, max_length=100, null=True)),
                ('time_lock_unlock_at', models.DateTimeField(blank=True, null=True)),
                ('qr_backup_generated', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_accessed_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='dna_encoded_passwords', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'DNA Encoded Password',
                'verbose_name_plural': 'DNA Encoded Passwords',
                'db_table': 'dna_encoded_password',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ChemicalStorageSubscription',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('tier', models.CharField(choices=[('free', 'Free (Demo)'), ('enterprise', 'Enterprise')], default='free', max_length=20)),
                ('status', models.CharField(choices=[('active', 'Active'), ('expired', 'Expired'), ('cancelled', 'Cancelled'), ('pending', 'Pending')], default='active', max_length=20)),
                ('lab_provider', models.CharField(default='mock', help_text='Preferred lab provider: mock, twist, idt, genscript', max_length=50)),
                ('max_passwords', models.IntegerField(default=1)),
                ('passwords_stored', models.IntegerField(default=0)),
                ('synthesis_credits', models.IntegerField(default=0, help_text='Pre-paid synthesis credits in base pairs')),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('real_synthesis_enabled', models.BooleanField(default=False)),
                ('physical_storage_enabled', models.BooleanField(default=False)),
                ('time_lock_enabled', models.BooleanField(default=True)),
                ('lab_integration_enabled', models.BooleanField(default=False, help_text='Alias for real_synthesis_enabled for compatibility')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='chemical_subscription', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Chemical Storage Subscription',
                'db_table': 'chemical_storage_subscription',
            },
        ),
        migrations.CreateModel(
            name='ChemicalStorageCertificate',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('sequence_hash', models.CharField(max_length=64)),
                ('encoding_method', models.CharField(default='huffman_nucleotide_v1', max_length=50)),
                ('error_correction_level', models.CharField(default='high', max_length=20)),
                ('synthesis_provider', models.CharField(blank=True, max_length=50, null=True)),
                ('synthesis_date', models.DateTimeField(blank=True, null=True)),
                ('storage_temperature_kelvin', models.FloatField(default=193.15, help_text='-80Â°C in Kelvin')),
                ('estimated_half_life_years', models.IntegerField(default=1000)),
                ('time_lock_enabled', models.BooleanField(default=False)),
                ('time_lock_mode', models.CharField(blank=True, max_length=20, null=True)),
                ('signature', models.CharField(max_length=256)),
                ('chain_of_custody', models.JSONField(blank=True, default=list, help_text='Custody transfer records')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('dna_password', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='certificates', to='security.dnaencodedpassword')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chemical_certificates', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Chemical Storage Certificate',
                'verbose_name_plural': 'Chemical Storage Certificates',
                'db_table': 'chemical_storage_certificate',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AdaptivePasswordConfig',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_enabled', models.BooleanField(default=False, help_text='User consent for typing pattern collection (opt-in)')),
                ('consent_given_at', models.DateTimeField(blank=True, help_text='When user explicitly enabled adaptive passwords', null=True)),
                ('consent_version', models.CharField(default='1.0', max_length=20)),
                ('suggestion_frequency_days', models.IntegerField(default=30, help_text='Days between adaptation suggestions (1-365)')),
                ('last_suggestion_at', models.DateTimeField(blank=True, null=True)),
                ('allow_centralized_training', models.BooleanField(default=True, help_text='Allow anonymized data for model improvement (with DP)')),
                ('allow_federated_learning', models.BooleanField(default=False, help_text='Use on-device training only (more private, opt-in)')),
                ('differential_privacy_epsilon', models.FloatField(default=0.5, help_text='DP epsilon value (0.1=strong, 1.0=weak, 0.5=balanced)')),
                ('auto_suggest_enabled', models.BooleanField(default=True, help_text='Automatically show adaptation suggestions')),
                ('typing_timing_enabled', models.BooleanField(default=True, help_text='Collect timing patterns (for rhythm analysis)')),
                ('error_position_enabled', models.BooleanField(default=True, help_text='Track error positions (for difficulty detection)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='adaptive_password_config', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Adaptive Password Config',
                'db_table': 'adaptive_password_config',
            },
        ),
        migrations.CreateModel(
            name='AdaptationFeedback',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('rating', models.IntegerField(choices=[(1, '1 - Very Poor'), (2, '2 - Poor'), (3, '3 - Neutral'), (4, '4 - Good'), (5, '5 - Excellent')], help_text='Overall rating 1-5')),
                ('typing_accuracy_improved', models.BooleanField(blank=True, help_text='Did typing accuracy improve?', null=True)),
                ('memorability_improved', models.BooleanField(blank=True, help_text='Was the password easier to remember?', null=True)),
                ('typing_speed_improved', models.BooleanField(blank=True, help_text='Did typing speed improve?', null=True)),
                ('additional_feedback', models.TextField(blank=True, help_text='Optional text feedback from user')),
                ('days_since_adaptation', models.IntegerField(default=0, help_text='Days between adaptation and feedback')),
                ('typing_sessions_since', models.IntegerField(default=0, help_text='Typing sessions between adaptation and feedback')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('adaptation', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='feedback', to='security.passwordadaptation')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='adaptation_feedback', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Adaptation Feedback',
                'verbose_name_plural': 'Adaptation Feedback',
                'db_table': 'adaptation_feedback',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TypingSession',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('password_hash_prefix', models.CharField(help_text='First 16 chars of password hash for correlation', max_length=16)),
                ('password_length', models.IntegerField(help_text='Length of password (for position normalization)')),
                ('success', models.BooleanField(help_text='Whether password was entered correctly')),
                ('attempt_number', models.IntegerField(default=1, help_text='Which attempt this was (1st, 2nd, etc.)')),
                ('error_positions', models.JSONField(default=list, help_text='List of positions where errors occurred (0-indexed)')),
                ('error_count', models.IntegerField(default=0)),
                ('timing_profile', models.JSONField(default=dict, help_text='Anonymized timing: {position: relative_delay_bucket}')),
                ('total_time_ms', models.IntegerField(blank=True, help_text='Total time to enter password in milliseconds', null=True)),
                ('device_type', models.CharField(default='desktop', help_text='desktop, mobile, tablet', max_length=20)),
                ('input_method', models.CharField(default='keyboard', help_text='keyboard, touchscreen, voice', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='typing_sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Typing Session',
                'verbose_name_plural': 'Typing Sessions',
                'db_table': 'typing_session',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['user', '-created_at'], name='typing_sess_user_id_c172ef_idx'), models.Index(fields=['password_hash_prefix', '-created_at'], name='typing_sess_passwor_8109ac_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='passwordadaptation',
            index=models.Index(fields=['user', 'status'], name='password_ad_user_id_765eae_idx'),
        ),
        migrations.AddIndex(
            model_name='passwordadaptation',
            index=models.Index(fields=['password_hash_prefix'], name='password_ad_passwor_ce4328_idx'),
        ),
        migrations.AddIndex(
            model_name='entanglementsyncevent',
            index=models.Index(fields=['pair', 'event_type'], name='entanglemen_pair_id_16b88a_idx'),
        ),
        migrations.AddIndex(
            model_name='entanglementsyncevent',
            index=models.Index(fields=['created_at'], name='entanglemen_created_56f648_idx'),
        ),
        migrations.AddConstraint(
            model_name='entangleddevicepair',
            constraint=models.UniqueConstraint(condition=models.Q(('status', 'active')), fields=('device_a', 'device_b'), name='unique_active_pair'),
        ),
        migrations.AddIndex(
            model_name='dnaencodedpassword',
            index=models.Index(fields=['user', 'status'], name='dna_encoded_user_id_0c4864_idx'),
        ),
        migrations.AddIndex(
            model_name='dnaencodedpassword',
            index=models.Index(fields=['sequence_hash'], name='dna_encoded_sequenc_092ace_idx'),
        ),
        migrations.AddIndex(
            model_name='dnaencodedpassword',
            index=models.Index(fields=['synthesis_order_id'], name='dna_encoded_synthes_82cf78_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='adaptationfeedback',
            unique_together={('adaptation', 'user')},
        ),
    ]
