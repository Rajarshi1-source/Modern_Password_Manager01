# Generated by Django 4.2.27 on 2026-01-31 16:59

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import uuid


class Migration(migrations.Migration):

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('security', '0007_globalentropystatistics_userentropypreferences_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='DuressCode',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code_hash', models.CharField(help_text='Argon2id hash of the duress code', max_length=256)),
                ('code_hint', models.CharField(blank=True, help_text="Optional hint for the user (e.g., 'family emergency code')", max_length=100)),
                ('threat_level', models.CharField(choices=[('low', 'Low - Show Limited Decoy'), ('medium', 'Medium - Full Decoy + Preserve Evidence'), ('high', 'High - Decoy + Alert Authorities + Lock Real Vault'), ('critical', 'Critical - Full Response + Wipe Session Keys')], default='medium', max_length=20)),
                ('action_config', models.JSONField(default=dict, help_text='Custom actions: {show_decoy: bool, alert_authorities: bool, ...}')),
                ('is_active', models.BooleanField(default=True)),
                ('activation_count', models.IntegerField(default=0, help_text='Number of times this code has been activated')),
                ('last_activated_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='duress_codes', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Duress Code',
                'verbose_name_plural': 'Duress Codes',
            },
        ),
        migrations.CreateModel(
            name='OceanEntropyUsageStats',
            fields=[
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, primary_key=True, related_name='ocean_entropy_stats', serialize=False, to=settings.AUTH_USER_MODEL)),
                ('total_ocean_passwords', models.IntegerField(default=0, help_text='Total passwords with ocean entropy')),
                ('total_hybrid_passwords', models.IntegerField(default=0, help_text='Total passwords mixing quantum + ocean')),
                ('favorite_buoy_id', models.CharField(blank=True, help_text='Most frequently used buoy', max_length=20)),
                ('favorite_buoy_usage_count', models.IntegerField(default=0)),
                ('average_quality_score', models.FloatField(default=0.0, help_text='Average quality across all ocean entropy fetches')),
                ('first_ocean_password', models.DateTimeField(blank=True, null=True)),
                ('last_ocean_password', models.DateTimeField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'Ocean Entropy Usage Stats',
                'db_table': 'ocean_entropy_usage_stats',
            },
        ),
        migrations.CreateModel(
            name='OceanEntropyBatch',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('buoy_id', models.CharField(help_text="NOAA buoy identifier (e.g., '44013')", max_length=20)),
                ('buoy_name', models.CharField(blank=True, help_text="Friendly buoy name (e.g., 'Boston 16 NM East of Boston')", max_length=255)),
                ('buoy_latitude', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True)),
                ('buoy_longitude', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True)),
                ('wave_height', models.FloatField(blank=True, help_text='Wave height in meters', null=True)),
                ('wave_period', models.FloatField(blank=True, help_text='Wave period in seconds', null=True)),
                ('wave_direction', models.IntegerField(blank=True, help_text='Wave direction in degrees', null=True)),
                ('water_temperature', models.FloatField(blank=True, help_text='Water temperature in Celsius', null=True)),
                ('wind_speed', models.FloatField(blank=True, help_text='Wind speed in m/s', null=True)),
                ('bytes_fetched', models.IntegerField(help_text='Number of entropy bytes generated')),
                ('quality_score', models.FloatField(help_text='Entropy quality score (0.0-1.0)')),
                ('shannon_entropy', models.FloatField(blank=True, help_text='Calculated Shannon entropy (bits per byte)', null=True)),
                ('buoy_reading_timestamp', models.DateTimeField(help_text='When the buoy took the reading')),
                ('fetched_at', models.DateTimeField(auto_now_add=True, help_text='When we fetched the entropy')),
                ('fetch_duration_ms', models.IntegerField(blank=True, help_text='Time to fetch in milliseconds', null=True)),
                ('api_response_code', models.IntegerField(blank=True, help_text='NOAA API response code', null=True)),
            ],
            options={
                'verbose_name': 'Ocean Entropy Batch',
                'verbose_name_plural': 'Ocean Entropy Batches',
                'db_table': 'ocean_entropy_batch',
                'ordering': ['-fetched_at'],
                'indexes': [models.Index(fields=['buoy_id', '-fetched_at'], name='ocean_entro_buoy_id_454636_idx'), models.Index(fields=['-quality_score'], name='ocean_entro_quality_121309_idx')],
            },
        ),
        migrations.CreateModel(
            name='EvidencePackage',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('collecting', 'Collecting Evidence'), ('complete', 'Evidence Complete'), ('exported', 'Exported for Legal Use'), ('sealed', 'Cryptographically Sealed')], default='collecting', max_length=20)),
                ('behavioral_snapshot', models.JSONField(default=dict, help_text='Behavioral biometrics at moment of duress')),
                ('device_info', models.JSONField(default=dict, help_text='Device fingerprint and hardware info')),
                ('network_info', models.JSONField(default=dict, help_text='Network details (IP, ISP, etc)')),
                ('geo_location', models.JSONField(default=dict, help_text='Geographic location data')),
                ('session_recording', models.JSONField(default=dict, help_text='Session activity since login')),
                ('encrypted_evidence_blob', models.BinaryField(blank=True, help_text='Full encrypted evidence package', null=True)),
                ('evidence_encryption_key_id', models.CharField(blank=True, help_text='Reference to encryption key (HSM)', max_length=100)),
                ('evidence_hash', models.CharField(blank=True, help_text='SHA-512 hash of evidence', max_length=128)),
                ('legal_timestamp', models.DateTimeField(blank=True, help_text='RFC 3161 timestamp token time', null=True)),
                ('timestamp_authority', models.CharField(blank=True, help_text='TSA that issued timestamp', max_length=200)),
                ('timestamp_token', models.BinaryField(blank=True, help_text='RFC 3161 timestamp token', null=True)),
                ('custody_log', models.JSONField(default=list, help_text='Log of evidence access/export')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('sealed_at', models.DateTimeField(blank=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Evidence retention policy expiry', null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evidence_packages', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Evidence Package',
                'verbose_name_plural': 'Evidence Packages',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DuressEvent',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('event_type', models.CharField(choices=[('code_activated', 'Duress Code Activated'), ('behavioral_detected', 'Behavioral Duress Detected'), ('manual_trigger', 'Manual Panic Trigger'), ('test_activation', 'Test Activation')], default='code_activated', max_length=30)),
                ('threat_level', models.CharField(choices=[('low', 'Low - Show Limited Decoy'), ('medium', 'Medium - Full Decoy + Preserve Evidence'), ('high', 'High - Decoy + Alert Authorities + Lock Real Vault'), ('critical', 'Critical - Full Response + Wipe Session Keys')], max_length=20)),
                ('ip_address', models.GenericIPAddressField()),
                ('user_agent', models.TextField(blank=True)),
                ('device_fingerprint', models.JSONField(default=dict, help_text='Device identification data')),
                ('geo_location', models.JSONField(default=dict, help_text='Geolocation at time of event')),
                ('behavioral_data', models.JSONField(default=dict, help_text='Stress indicators from DuressDetector')),
                ('behavioral_stress_score', models.FloatField(default=0.0, help_text='Stress score at time of event')),
                ('response_status', models.CharField(choices=[('success', 'Response Executed Successfully'), ('partial', 'Partial Response (Some Actions Failed)'), ('failed', 'Response Failed')], default='success', max_length=20)),
                ('actions_taken', models.JSONField(default=list, help_text='List of actions executed')),
                ('silent_alarm_sent', models.BooleanField(default=False)),
                ('authorities_notified', models.JSONField(default=list, help_text='List of authorities notified')),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('session_duration_seconds', models.IntegerField(default=0, help_text='Duration of duress session')),
                ('duress_code', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='events', to='security.duresscode')),
                ('evidence_package', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='duress_events', to='security.evidencepackage')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='duress_events', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Duress Event',
                'verbose_name_plural': 'Duress Events',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='DuressCodeConfiguration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_enabled', models.BooleanField(default=False, help_text='Master switch for duress protection')),
                ('threat_level_count', models.IntegerField(default=3, help_text='Number of threat levels (1-5)')),
                ('evidence_preservation_enabled', models.BooleanField(default=True, help_text='Automatically preserve forensic evidence on duress')),
                ('silent_alarm_enabled', models.BooleanField(default=False, help_text='Send silent alerts to trusted authorities')),
                ('behavioral_detection_enabled', models.BooleanField(default=True, help_text='Use behavioral analysis to detect duress')),
                ('legal_compliance_mode', models.BooleanField(default=False, help_text='Enable RFC 3161 timestamping and legal export')),
                ('is_enterprise', models.BooleanField(default=False, help_text='Enterprise tier with full features')),
                ('auto_refresh_decoy', models.BooleanField(default=True, help_text='Automatically refresh decoy vault periodically')),
                ('decoy_refresh_interval_days', models.IntegerField(default=7, help_text='Days between decoy vault refreshes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_tested_at', models.DateTimeField(blank=True, help_text='Last time user tested duress system', null=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='duress_config', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Duress Configuration',
                'verbose_name_plural': 'Duress Configurations',
            },
        ),
        migrations.CreateModel(
            name='DecoyVault',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('threat_level', models.CharField(choices=[('low', 'Low - Show Limited Decoy'), ('medium', 'Medium - Full Decoy + Preserve Evidence'), ('high', 'High - Decoy + Alert Authorities + Lock Real Vault'), ('critical', 'Critical - Full Response + Wipe Session Keys')], default='medium', max_length=20)),
                ('decoy_items', models.JSONField(default=list, help_text='List of fake credential entries')),
                ('decoy_folders', models.JSONField(default=list, help_text='Folder structure for realism')),
                ('item_count', models.IntegerField(default=0, help_text='Number of decoy items')),
                ('mirrors_real_structure', models.BooleanField(default=True, help_text="Mirrors real vault's folder structure")),
                ('includes_tracking_tokens', models.BooleanField(default=True, help_text='Embed tracking tokens in decoy credentials')),
                ('realism_score', models.FloatField(default=0.0, help_text='AI-computed realism score (0-1)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_refreshed', models.DateTimeField(auto_now=True)),
                ('last_accessed', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='decoy_vaults', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Decoy Vault',
                'verbose_name_plural': 'Decoy Vaults',
            },
        ),
        migrations.CreateModel(
            name='BuoyHealthStatus',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('buoy_id', models.CharField(max_length=20)),
                ('buoy_name', models.CharField(blank=True, max_length=255)),
                ('health_status', models.CharField(choices=[('excellent', 'Excellent'), ('good', 'Good'), ('degraded', 'Degraded'), ('offline', 'Offline')], max_length=20)),
                ('data_freshness_minutes', models.IntegerField(help_text='Minutes since last buoy reading')),
                ('data_completeness', models.FloatField(help_text='Fraction of expected parameters present (0.0-1.0)')),
                ('average_quality_score', models.FloatField(help_text='Average quality score over recent readings')),
                ('uptime_percentage', models.FloatField(help_text='Percentage uptime over last 24 hours')),
                ('total_readings_24h', models.IntegerField(help_text='Number of readings in last 24 hours')),
                ('current_wave_height', models.FloatField(blank=True, null=True)),
                ('current_wind_speed', models.FloatField(blank=True, null=True)),
                ('last_successful_fetch', models.DateTimeField(blank=True, null=True)),
                ('last_check', models.DateTimeField(auto_now=True)),
                ('recorded_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Buoy Health Status',
                'verbose_name_plural': 'Buoy Health Statuses',
                'db_table': 'buoy_health_status',
                'ordering': ['-recorded_at'],
                'indexes': [models.Index(fields=['buoy_id', '-recorded_at'], name='buoy_health_buoy_id_a8ab6f_idx'), models.Index(fields=['health_status'], name='buoy_health_health__13d3c3_idx')],
            },
        ),
        migrations.CreateModel(
            name='TrustedAuthority',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=200)),
                ('authority_type', models.CharField(choices=[('law_enforcement', 'Law Enforcement'), ('legal_counsel', 'Legal Counsel'), ('security_team', 'Corporate Security Team'), ('family', 'Family/Emergency Contact'), ('custom', 'Custom Contact')], max_length=30)),
                ('contact_method', models.CharField(choices=[('email', 'Email'), ('sms', 'SMS'), ('phone', 'Phone Call'), ('webhook', 'Webhook/API'), ('signal', 'Signal Messenger')], default='email', max_length=20)),
                ('contact_details', models.JSONField(help_text='Encrypted contact info: {email/phone/webhook_url}')),
                ('trigger_threat_levels', models.JSONField(default=list, help_text='List of threat levels that trigger notification')),
                ('verification_status', models.CharField(choices=[('pending', 'Verification Pending'), ('verified', 'Verified'), ('failed', 'Verification Failed'), ('expired', 'Verification Expired')], default='pending', max_length=20)),
                ('verification_code', models.CharField(blank=True, max_length=100)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('delay_seconds', models.IntegerField(default=0, help_text='Delay before sending alert (stealth mode)')),
                ('include_location', models.BooleanField(default=True, help_text='Include location in alert')),
                ('include_evidence_link', models.BooleanField(default=False, help_text='Include link to evidence package')),
                ('is_active', models.BooleanField(default=True)),
                ('notification_count', models.IntegerField(default=0)),
                ('last_notified_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trusted_authorities', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Trusted Authority',
                'verbose_name_plural': 'Trusted Authorities',
                'indexes': [models.Index(fields=['user', 'is_active'], name='security_tr_user_id_587ca9_idx'), models.Index(fields=['user', 'authority_type'], name='security_tr_user_id_02a22a_idx'), models.Index(fields=['verification_status'], name='security_tr_verific_a477f4_idx')],
            },
        ),
        migrations.CreateModel(
            name='HybridPasswordCertificate',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('password_hash_prefix', models.CharField(help_text='First 16 chars of SHA256 hash', max_length=64)),
                ('sources_used', models.JSONField(help_text="List of sources: ['quantum', 'ocean', 'genetic']")),
                ('quantum_provider', models.CharField(blank=True, help_text='Quantum provider (ANU/IBM/IonQ)', max_length=50)),
                ('quantum_certificate_id', models.UUIDField(blank=True, help_text='Reference to QuantumPasswordCertificate', null=True)),
                ('ocean_buoy_id', models.CharField(blank=True, help_text='NOAA buoy used', max_length=20)),
                ('ocean_batch_id', models.UUIDField(blank=True, help_text='Reference to OceanEntropyBatch', null=True)),
                ('ocean_wave_height', models.FloatField(blank=True, help_text='Wave height at generation time', null=True)),
                ('genetic_provider', models.CharField(blank=True, help_text='Genetic provider (Sequencing.com/23andMe/etc.)', max_length=50)),
                ('genetic_certificate_id', models.UUIDField(blank=True, help_text='Reference to GeneticPasswordCertificate', null=True)),
                ('mixing_algorithm', models.CharField(default='XOR + SHA3-512 + SHAKE256', help_text='Algorithm used to combine sources', max_length=100)),
                ('total_entropy_bits', models.IntegerField(help_text='Total entropy bits from all sources')),
                ('password_length', models.IntegerField()),
                ('charset_used', models.CharField(default='standard', help_text='Character types: uppercase,lowercase,numbers,symbols', max_length=100)),
                ('combined_quality_score', models.FloatField(help_text='Combined quality score (0.0-1.0)')),
                ('generation_timestamp', models.DateTimeField(auto_now_add=True)),
                ('signature', models.CharField(help_text='HMAC signature of certificate data', max_length=256)),
                ('vault_item_id', models.CharField(blank=True, help_text='Link to password manager vault item', max_length=100, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='hybrid_certificates', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Hybrid Password Certificate',
                'verbose_name_plural': 'Hybrid Password Certificates',
                'db_table': 'hybrid_password_certificate',
                'ordering': ['-generation_timestamp'],
                'indexes': [models.Index(fields=['user', '-generation_timestamp'], name='hybrid_pass_user_id_0c376e_idx'), models.Index(fields=['password_hash_prefix'], name='hybrid_pass_passwor_d0bd6f_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='evidencepackage',
            index=models.Index(fields=['user', 'status'], name='security_ev_user_id_9f93af_idx'),
        ),
        migrations.AddIndex(
            model_name='evidencepackage',
            index=models.Index(fields=['created_at'], name='security_ev_created_eeb889_idx'),
        ),
        migrations.AddIndex(
            model_name='duressevent',
            index=models.Index(fields=['user', 'timestamp'], name='security_du_user_id_317538_idx'),
        ),
        migrations.AddIndex(
            model_name='duressevent',
            index=models.Index(fields=['user', 'threat_level'], name='security_du_user_id_ede616_idx'),
        ),
        migrations.AddIndex(
            model_name='duressevent',
            index=models.Index(fields=['event_type', 'timestamp'], name='security_du_event_t_65932a_idx'),
        ),
        migrations.AddIndex(
            model_name='duresscode',
            index=models.Index(fields=['user', 'is_active'], name='security_du_user_id_fa6e51_idx'),
        ),
        migrations.AddIndex(
            model_name='duresscode',
            index=models.Index(fields=['user', 'threat_level'], name='security_du_user_id_0efd0c_idx'),
        ),
        migrations.AddIndex(
            model_name='decoyvault',
            index=models.Index(fields=['user', 'threat_level'], name='security_de_user_id_324333_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='decoyvault',
            unique_together={('user', 'threat_level')},
        ),
    ]
